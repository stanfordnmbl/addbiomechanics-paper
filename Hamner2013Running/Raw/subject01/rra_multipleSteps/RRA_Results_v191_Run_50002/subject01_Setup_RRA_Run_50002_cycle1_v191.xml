<!-- Copyright (c) 2013, Stanford University

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE 
SOFTWARE.

Please cite: Hamner, S.R., Delp, S.L. (2013) Muscle contributions to fore-aft and vertical body mass center accelerations 
over a range of running speeds. Journal of Biomechanics, vol 46, pp 780-787.-->

<?xml version="1.0" encoding="utf-8"?>
<OpenSimDocument Version="10600">
	
   <CMCTool name="subject01_Run_50002_cycle1">
		<!--Name of the .osim file used to construct a model.-->
		
      <model_file> ../../scale/subject01_scaled_v191.osim </model_file>
		<!--Replace the model's actuator set with sets specified in
		    <actuator_set_files>? If false, the actuator set is appended to.-->
		
      <replace_actuator_set> true </replace_actuator_set>
		<!--List of xml files used to construct an actuator set for the model.-->
		
      <actuator_set_files> ../gait2392_RRA_Actuators_v191.xml </actuator_set_files>
		<!--Replace the model's contact force set with sets specified in
		    <contact_force_set_files>? If false, contact force set is appended to.-->
		
      <replace_contact_force_set> true </replace_contact_force_set>
		<!--List of xml files used to construct a contact set for the model.-->
		
      <contact_force_set_files> </contact_force_set_files>
		<!--Directory used for writing results.-->
		
      <results_directory>RRA_Results_v191_Run_50002_cycle1</results_directory>
		<!--Output precision.  It is 20 by default.-->
		
      <output_precision> 20 </output_precision>
		<!--Initial time for the simulation.-->
		
      <initial_time>0.549</initial_time>
		<!--Final time for the simulation.-->
		
      <final_time>1.143</final_time>
		<!--Flag indicating whether or not to compute equilibrium values for
		    states other than the coordinates or speeds.  For example, equilibrium
		    muscle fiber lengths or muscle forces.-->
		
      <solve_for_equilibrium_for_auxiliary_states> false </solve_for_equilibrium_for_auxiliary_states>
		<!--Maximum number of integrator steps.-->
		
      <maximum_number_of_integrator_steps> 20000 </maximum_number_of_integrator_steps>
		<!--Maximum integration step size.-->
		
      <maximum_integrator_step_size>       0.0001 </maximum_integrator_step_size>
		<!--Minimum integration step size.-->
		
      <minimum_integrator_step_size>       0.00000001 </minimum_integrator_step_size>
		<!--Integrator error tolerance. When the error is greater, the integrator
		    step size is decreased.-->
		
      <integrator_error_tolerance>       0.00001 </integrator_error_tolerance>
		<!--Integrator fine tolerance. When the error is less, the integrator step
		    size is increased.-->
		
      <integrator_fine_tolerance>       0.00001</integrator_fine_tolerance>
		<!--Set of analyses to be run during the investigation.-->
		
      <AnalysisSet name="Analyses">
			
         <objects/>
			
         <groups/>
		
      </AnalysisSet>
		<!--Motion (.mot) or storage (.sto) file containing the desired point
		    trajectories.-->
		
      <desired_points_file>  </desired_points_file>
		<!--Motion (.mot) or storage (.sto) file containing the desired kinematic
		    trajectories.-->
		
      <desired_kinematics_file>..\..\ik\Results_191\Run_50002.mot</desired_kinematics_file>
		<!--Motion file (.mot) or storage file (.sto) containing the external
		    loads applied to the model.-->
		
      <external_loads_file>..\..\ExportedData\Run_500 02_newCOP3.mot</external_loads_file>
		<!--Motion file (.mot) or storage file (.sto) containing the model
		    kinematics corresponding to the external loads.-->
		
      <external_loads_model_kinematics_file>..\..\ik\Results_191\Run_50002.mot</external_loads_model_kinematics_file>
		<!--Name of the body to which the first set of external loads should be
		    applied (e.g., the name of the right foot).-->
		
      <external_loads_body1> calcn_r </external_loads_body1>
		<!--Name of the body to which the second set of external loads should be
		    applied (e.g., the name of the left foot).-->
		
      <external_loads_body2> calcn_l </external_loads_body2>
		<!--File containing the tracking tasks. Which coordinates are tracked and
		    with what weights are specified here.-->
		
      <task_set_file> ../gait2392_RRA_Tasks_v191.xml </task_set_file>
		<!--File containing the constraints on the controls.-->
		
      <constraints_file> ../gait2392_RRA_ControlConstraints_v191.xml </constraints_file>
		<!--File containing the controls output by RRA. These can be used to place
		    constraints on the residuals during CMC.-->
		
      <rra_controls_file>  </rra_controls_file>
		<!--Low-pass cut-off frequency for filtering the desired kinematics. A
		    negative value results in no filtering. The default value is -1.0, so
		    no filtering.-->
		
      <lowpass_cutoff_frequency>      15.0 </lowpass_cutoff_frequency>
		<!--Low-pass cut-off frequency for filtering the model kinematics
		    corresponding to the external loads. A negative value results in no
		    filtering. The default value is -1.0, so no filtering.-->
		
      <lowpass_cutoff_frequency_for_load_kinematics>      15.0 </lowpass_cutoff_frequency_for_load_kinematics>
		<!--Time window over which the desired actuator forces are achieved.
		    Muscles forces cannot change instantaneously, so a finite time window
		    must be allowed. The recommended time window for RRA is about 0.001
		    sec, and for CMC is about 0.010 sec.-->
		
      <cmc_time_window>       0.001 </cmc_time_window>
		<!--Flag (true or false) indicating whether or not to use the curvature
		    filter. Setting this flag to true can reduce oscillations in the
		    computed muscle excitations.-->
		
      <use_curvature_filter> true </use_curvature_filter>
		<!--Flag (true or false) indicating whether or not to use reflexes.  This
		    is a hook for users wanting to modify controls based on additonal
		    information.-->
		
      <use_reflexes> false </use_reflexes>
		<!--Flag (true or false) indicating whether to use the fast CMC
		    optimization target. The fast target requires the desired
		    accelerations to be met. The optimizer fails if the acclerations
		    constraints cannot be met, so the fast target can be less robust.  The
		    regular target does not require the acceleration constraints to be
		    met; it meets them as well as it can, but it is slower and less
		    accurate.-->
		
      <use_fast_optimization_target> false </use_fast_optimization_target>
		<!--Preferred optimizer algorithm (currently support "ipopt" or "cfsqp",
		    the latter requiring the osimFSQP library.-->
		
      <optimizer_algorithm> cfsqp </optimizer_algorithm>
		<!--Perturbation size used by the optimizer to compute numerical
		    derivatives. A value between 1.0e-4 and 1.0e-8 is usually
		    approprieate.-->
		
      <optimizer_derivative_dx>       0.0001 </optimizer_derivative_dx>
		<!--Convergence criterion for the optimizer. The smaller this value, the
		    deeper the convergence. Decreasing this number can improve a solution,
		    but will also likely increase computation time.-->
		
      <optimizer_convergence_criterion>       0.000001 </optimizer_convergence_criterion>
		<!--Maximum number of iterations for the optimizer.-->
		
      <optimizer_max_iterations> 1000 </optimizer_max_iterations>
		<!--Print level for the optimizer, 0 - 3. 0=no printing, 3=detailed
		    printing, 2=in between-->
		
      <optimizer_print_level> 0 </optimizer_print_level>
		<!--Flag (true or false) indicating whether or not to compute average
		    residuals. No actions are taken based on this flag other than printing
		    the average residuals, which can be useful for seeing if the solution
		    is good.  Average residuals should be be close to 0.0.  If not, there
		    is likely problem in the experimental data, in the model, or both.-->
		
      <compute_average_residuals> true </compute_average_residuals>
		<!--Flag (true or false) indicating whether or not to make an adjustment
		    in the center of mass of a body to reduced DC offsets in MX and MZ. If
		    true, a new model is writen out that has altered anthropometry.-->
		
      <adjust_com_to_reduce_residuals> true </adjust_com_to_reduce_residuals>
		<!--Initial time used when computing average residuals in order to adjust
		    the body's center of mass.  If both initial and final time are set to
		    -1 (their default value) then the main initial and final time settings
		    will be used.-->
		
      <initial_time_for_com_adjustment>      -1.00000000000000000000 </initial_time_for_com_adjustment>
		<!--Final time used when computing average residuals in order to adjust
		    the body's center of mass.-->
		
      <final_time_for_com_adjustment>      -1.00000000000000000000 </final_time_for_com_adjustment>
		<!--Name of the body whose center of mass is adjusted. The heaviest
		    segment in the model should normally be chosen. For a gait model, the
		    torso segment is usually the best choice.-->
		
      <adjusted_com_body> torso </adjusted_com_body>
		<!--Name of the output model file (.osim) containing adjustments to
		    anthropometry made to reduce average residuals. This file is written
		    if the property adjust_com_to_reduce_residuals is set to true. If a
		    name is not specified, the model is written out to a file called
		    adjusted_model.osim.-->
		
      <output_model_file>subject01_RRA_adjusted_Run_50002_cycle1_v191.osim</output_model_file>
		<!--Flag (true or false) indicating whether or not to adjust the
		    kinematics in order to reduce residuals.  Set this flag to false, and
		    set adjust_com_to_reduce_residuals on in order to only adjust the
		    model's center of mass without adjusting kinematics-->
		
      <adjust_kinematics_to_reduce_residuals> true </adjust_kinematics_to_reduce_residuals>
		<!--True-false flag indicating whether or not to turn on verbose printing
		    for cmc.-->
		
      <use_verbose_printing> false </use_verbose_printing>
	
   </CMCTool>

</OpenSimDocument>